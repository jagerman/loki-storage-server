From: Jason Rhinelander <jason@imaginary.ca>
Date: Tue, 16 Jul 2019 16:08:10 -0300
Subject: Partially devendor loki-storage-server

---
 crypto/CMakeLists.txt     | 1 -
 crypto/src/signature.cpp  | 4 ++--
 httpserver/CMakeLists.txt | 9 +--------
 storage/CMakeLists.txt    | 4 ++--
 4 files changed, 5 insertions(+), 13 deletions(-)

diff --git a/crypto/CMakeLists.txt b/crypto/CMakeLists.txt
index a0d3a55..b349eb3 100644
--- a/crypto/CMakeLists.txt
+++ b/crypto/CMakeLists.txt
@@ -34,7 +34,6 @@ target_include_directories(crypto
     ${CMAKE_CURRENT_LIST_DIR}/include
     PRIVATE
     ${CMAKE_CURRENT_LIST_DIR}/src
-    ${CMAKE_CURRENT_LIST_DIR}/../vendors
 )
 
 loki_add_subdirectory(../utils utils)
diff --git a/crypto/src/signature.cpp b/crypto/src/signature.cpp
index 4efee3e..d2ccf3b 100644
--- a/crypto/src/signature.cpp
+++ b/crypto/src/signature.cpp
@@ -2,8 +2,8 @@
 #include "utils.hpp"
 
 extern "C" {
-#include "loki/crypto-ops/crypto-ops.h"
-#include "loki/crypto-ops/hash-ops.h"
+#include "loki-core/crypto/crypto-ops.h"
+#include "loki-core/crypto/hash-ops.h"
 }
 
 #include <sodium/crypto_generichash.h>
diff --git a/httpserver/CMakeLists.txt b/httpserver/CMakeLists.txt
index 78a1ce8..c50f9ff 100644
--- a/httpserver/CMakeLists.txt
+++ b/httpserver/CMakeLists.txt
@@ -81,16 +81,9 @@ set_property(TARGET httpserver PROPERTY CXX_STANDARD 14)
 target_link_libraries(httpserver PRIVATE httpserver_lib)
 install(TARGETS httpserver DESTINATION bin)
 # Build Info
-execute_process(
-    COMMAND
-        git rev-parse --short HEAD
-    OUTPUT_VARIABLE
-        SHORT_HASH
-    OUTPUT_STRIP_TRAILING_WHITESPACE)
 string(TIMESTAMP BUILD_TIME UTC)
-message(STATUS "using git commit hash ${SHORT_HASH}")
 message(STATUS "using UTC build time ${BUILD_TIME}")
-target_compile_definitions(httpserver PRIVATE -DSTORAGE_SERVER_GIT_HASH_STRING="${SHORT_HASH}")
+target_compile_definitions(httpserver PRIVATE -DSTORAGE_SERVER_GIT_HASH_STRING="deb-${LOKISS_VERSION_TAG}")
 target_compile_definitions(httpserver PRIVATE -DSTORAGE_SERVER_BUILD_TIME="${BUILD_TIME}")
 
 find_package(PkgConfig QUIET)
diff --git a/storage/CMakeLists.txt b/storage/CMakeLists.txt
index 8ddd6fe..ee7c7a1 100644
--- a/storage/CMakeLists.txt
+++ b/storage/CMakeLists.txt
@@ -21,8 +21,8 @@ loki_add_subdirectory(../common common)
 target_link_libraries(storage PRIVATE common)
 loki_add_subdirectory(../utils utils)
 target_link_libraries(storage PRIVATE utils)
-loki_add_subdirectory(../vendors/sqlite sqlite)
-target_link_libraries(storage PRIVATE sqlite)
+find_library(SQLITE3_LIBRARY sqlite3)
+target_link_libraries(storage PRIVATE ${SQLITE3_LIBRARY})
 
 
 if(NOT Boost_FOUND)
